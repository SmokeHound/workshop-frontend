<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Item Admin (Tabbed)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet" />
  <link href="assets/styles.css" rel="stylesheet" />
</head>
<body class="bg-light">
  <nav class="navbar navbar-dark bg-dark mb-4 px-4">
    <span class="navbar-brand">üõ† Item Admin Panel</span>
    <a href="index.html" class="btn btn-outline-light btn-sm">Dashboard</a>
  </nav>

  <div class="container">
    <!-- Tabs -->
    <ul class="nav nav-tabs mb-3" id="admin-tabs" role="tablist">
      <li class="nav-item" role="presentation">
        <button class="nav-link active" id="add-tab" data-bs-toggle="tab" data-bs-target="#add-pane" type="button" role="tab">‚ûï Add Item</button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link" id="list-tab" data-bs-toggle="tab" data-bs-target="#list-pane" type="button" role="tab">üìã Item Catalog</button>
      </li>
    </ul>

    <div class="tab-content" id="admin-tabContent">
      <!-- Add Item Tab -->
      <div class="tab-pane fade show active" id="add-pane" role="tabpanel">
        <form id="add-form" class="card p-4 shadow-sm bg-white mb-4">
          <h5>Add New Item</h5>
          <div class="mb-2">
            <label for="name" class="form-label">Item Name</label>
            <input type="text" id="name" class="form-control" required />
          </div>
          <div class="mb-3">
            <label for="price" class="form-label">Price (AUD)</label>
            <input type="number" id="price" class="form-control" step="0.01" required />
          </div>
          <button class="btn btn-success" type="submit">
            <i class="fas fa-plus-circle"></i> Add Item
          </button>
        </form>
        <div id="add-result" class="text-success fw-bold" style="display:none;"></div>
      </div>

      <!-- Catalog Tab -->
      <div class="tab-pane fade" id="list-pane" role="tabpanel">
        <div class="card shadow-sm p-3 bg-white">
          <h5>Item Catalog</h5>
          <table class="table table-bordered" id="item-table">
            <thead class="table-dark">
              <tr>
                <th>Name</th>
                <th>Price</th>
                <th style="width: 100px;">Actions</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>
    </div>
  </div>

  <script>
    const backend = "https://workshop-order.onrender.com";

    function loadItems() {
      fetch(`${backend}/api/items`)
        .then(r => r.json())
        .then(data => {
          const tbody = document.querySelector('#item-table tbody');
          tbody.innerHTML = "";
          data.forEach(item => {
            const tr = document.createElement('tr');
            tr.innerHTML = `
              <td><input class="form-control name" value="${item.name}" /></td>
              <td><input class="form-control price" type="number" step="0.01" value="${item.price}" /></td>
              <td>
                <button class="btn btn-sm btn-primary save">üíæ</button>
                <button class="btn btn-sm btn-danger delete">üóëÔ∏è</button>
              </td>
            `;
            tr.querySelector('.save').onclick = () => {
              const name = tr.querySelector('.name').value.trim();
              const price = parseFloat(tr.querySelector('.price').value);
              fetch(`${backend}/api/items/${item.id}`, {
                method: 'PUT',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ name, price })
              }).then(() => loadItems());
            };
            tr.querySelector('.delete').onclick = () => {
              if (confirm(`Delete "${item.name}"?`)) {
                fetch(`${backend}/api/items/${item.id}`, { method: 'DELETE' })
                  .then(() => loadItems());
              }
            };
            tbody.appendChild(tr);
          });
        });
    }

    document.getElementById('add-form').onsubmit = e => {
      e.preventDefault();
      const name = document.getElementById('name').value.trim();
      const price = parseFloat(document.getElementById('price').value);

      fetch(`${backend}/api/items`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ name, price })
      }).then(r => {
        if (r.ok) {
          document.getElementById('add-result').textContent = `${name} added for $${price.toFixed(2)}!`;
          document.getElementById('add-result').style.display = 'block';
          document.getElementById('add-form').reset();
          loadItems();
        } else {
          alert('Failed to add item');
        }
      });
    };

    // Load item catalog on tab switch
    document.getElementById('list-tab').addEventListener('click', loadItems);
  </script>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>